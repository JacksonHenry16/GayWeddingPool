<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wedding Pool</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --ink: #1f2937;
      --muted: #6b7280;
      --accent: #4f46e5;
      --accent-2: #22c55e;
      --border: #e5e7eb;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--ink);
      line-height: 1.5;
    }
    @media (min-width: 900px) {
      body { padding: 32px; }
    }
    .container { max-width: 1100px; margin: 0 auto; display:flex; flex-direction:column; gap:16px; }
    header { display: flex; flex-direction: column; align-items: flex-start; gap: 12px; }
    @media (min-width: 640px) {
      header { flex-direction: row; align-items: center; justify-content: space-between; }
    }
    h1 { font-size: 24px; margin: 0; }
    @media (min-width: 640px) {
      h1 { font-size: 32px; }
    }
    .blurb { color: var(--muted); font-size: 14px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; box-shadow: 0 4px 14px rgba(0,0,0,0.04); }
    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 768px) { .grid.two { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    section h2 { margin: 0 0 12px; font-size: 18px; }
    .q { padding: 14px; border:1px solid var(--border); border-radius: 12px; }
    .q p { margin: 0 0 10px; font-weight: 600; }
    .row { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
    label { display: inline-flex; align-items: center; gap: 8px; cursor: pointer; }
    input[type="text"], input[type="password"], select { padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); width: 100%; font-size: 14px; }
    .toolbar { display:grid; gap:8px; width:100%; }
    @media (min-width: 640px) {
      .toolbar { display:flex; width:auto; flex-wrap:wrap; }
    }
    button { border: 1px solid var(--border); background: var(--card); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; width: 100%; }
    @media (min-width: 640px) {
      button { width:auto; }
    }
    button.primary { background: var(--accent); color: white; border-color: var(--accent); }
    button.success { background: var(--accent-2); color: white; border-color: var(--accent-2); }
    .footer { color: var(--muted); font-size: 12px; }
    .req { color: var(--danger); font-size: 12px; margin-top: 6px; display: none; }
    .pill { background:#eef2ff; color:#3730a3; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid #c7d2fe; }
    .stack { display:flex; flex-direction:column; gap:12px; }
    .view { display:none; }
    .view.active { display:block; }
    form.stack > button { align-self:flex-start; }
    .error { color: var(--danger); font-size: 13px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 12px; border-bottom: 1px solid var(--border); text-align: left; font-size: 14px; }
    th { background: #eef2ff; font-size: 13px; text-transform: uppercase; letter-spacing: 0.04em; color: #312e81; }
    tr.highlight { background: #ecfdf5; }
    .status-chip { display:inline-flex; align-items:center; gap:6px; padding:2px 10px; border-radius:999px; font-size:12px; border:1px solid var(--border); }
    .status-chip.correct { background:#dcfce7; color:#166534; border-color:#bbf7d0; }
    .status-chip.incorrect { background:#fee2e2; color:#b91c1c; border-color:#fecaca; }
    .status-chip.pending { background:#fef3c7; color:#b45309; border-color:#fde68a; }
    .section-title { margin: 0 0 8px; font-size: 16px; font-weight: 600; }
    .meta { font-size: 13px; color: var(--muted); }
    .results-note { margin: 0; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Wedding Pool</h1>
        <p class="blurb">Friday / Saturday lines — <span class="pill">$5 per entry</span> — most correct wins the pot.</p>
      </div>
      <div class="stack card" style="padding:14px;">
        <div style="font-weight:600;">Pool Hub</div>
        <div class="meta" id="headerStatus">Sign in to start making your picks.</div>
      </div>
    </header>

    <div id="authView" class="view active">
      <div class="card">
        <h2 style="margin-top:0;">Join the pool</h2>
        <p class="blurb">Create a quick account with your name and a password, then submit your answers. Every time you sign back in, you’ll land on the live scoreboard.</p>
        <div class="grid two">
          <form id="registerForm" class="stack">
            <h3 style="margin:0;">Create account</h3>
            <label class="stack">
              <span>First name</span>
              <input type="text" id="registerFirst" autocomplete="given-name" required />
            </label>
            <label class="stack">
              <span>Last name</span>
              <input type="text" id="registerLast" autocomplete="family-name" required />
            </label>
            <label class="stack">
              <span>Password</span>
              <input type="password" id="registerPassword" autocomplete="new-password" required />
            </label>
            <div class="error" id="registerError"></div>
            <button type="submit" class="primary">Create account</button>
          </form>

          <form id="loginForm" class="stack">
            <h3 style="margin:0;">Already playing?</h3>
            <label class="stack">
              <span>First name</span>
              <input type="text" id="loginFirst" autocomplete="given-name" required />
            </label>
            <label class="stack">
              <span>Last name</span>
              <input type="text" id="loginLast" autocomplete="family-name" required />
            </label>
            <label class="stack">
              <span>Password</span>
              <input type="password" id="loginPassword" autocomplete="current-password" required />
            </label>
            <div class="error" id="loginError"></div>
            <button type="submit" class="primary">Sign in</button>
          </form>
        </div>
      </div>
    </div>

    <div id="picksView" class="view">
      <div class="card">
        <header>
          <div>
            <h2 style="margin:0;">Make your picks</h2>
            <p class="blurb">Signed in as <strong id="picksUserName"></strong></p>
          </div>
          <div class="toolbar">
            <button id="toStatus">View status</button>
            <button id="logoutFromPicks">Log out</button>
          </div>
        </header>
        <p class="meta">Choose an answer for every line below, then save your card.</p>
      </div>
      <div id="questionSections" class="grid two"></div>
      <div class="card">
        <div class="toolbar">
          <button class="primary" id="savePicks">Save picks</button>
          <button id="exportPicks">Export CSV</button>
          <button id="copyPicks">Copy JSON</button>
          <button class="success" id="printPicks">Print card</button>
        </div>
        <div class="error" id="picksError" style="margin-top:12px;"></div>
        <p class="footer" style="margin-top:10px;">Your entry saves to this browser. Export or copy the JSON to send it elsewhere.</p>
      </div>
    </div>

    <div id="statusView" class="view">
      <div class="card">
        <header>
          <div>
            <h2 style="margin:0;">Live status</h2>
            <p class="blurb">Signed in as <strong id="statusUserName"></strong></p>
          </div>
          <div class="toolbar">
            <button id="editPicks">Edit picks</button>
            <button id="logoutFromStatus">Log out</button>
          </div>
        </header>
        <p class="meta">Track everyone’s score as outcomes are marked below.</p>
      </div>

      <div class="card">
        <h3 class="section-title">Scoreboard</h3>
        <div class="meta" id="scoreboardMeta"></div>
        <div style="overflow-x:auto; margin-top:12px;">
          <table>
            <thead>
              <tr>
                <th>Player</th>
                <th>Correct</th>
                <th>Resolved lines</th>
                <th>Submitted</th>
              </tr>
            </thead>
            <tbody id="scoreboardBody"></tbody>
          </table>
        </div>
      </div>

      <div class="grid two">
        <div class="card">
          <h3 class="section-title">Mark actual results</h3>
          <p class="meta">Update each line as the events happen. Everyone’s standings update instantly.</p>
          <div id="resultsEditor" class="stack"></div>
        </div>
        <div class="card">
          <h3 class="section-title">Your card</h3>
          <div id="myPicks"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const storageKeys = {
      users: 'weddingPoolUsers',
      results: 'weddingPoolResults',
      session: 'weddingPoolSession'
    };

    const sections = [
      {
        title: 'Rehearsal Dinner Lines',
        questions: [
          { key: 'rd_toasts', prompt: 'Over/Under 3.5 total toasts given', options: ['Over', 'Under'] },
          { key: 'rd_proposal_ref', prompt: 'Will someone reference the proposal story?', options: ['Yes', 'No'] },
          { key: 'rd_phone_read', prompt: 'Will someone read from their phone during a toast?', options: ['Yes', 'No'] },
          { key: 'rd_journey_word', prompt: 'Will anyone use the word “journey” in a toast?', options: ['Yes', 'No'] },
          { key: 'rd_bible_quotes', prompt: 'How many Bible verses quoted in the speeches?', options: ['Over 2.5', 'Under 2.5'] },
          { key: 'rd_music_bg', prompt: 'Will music be playing in the background during dinner?', options: ['Yes', 'No'] },
          { key: 'rd_cant_wait_mentions', prompt: 'Over/Under 2.5 total mentions of “can’t wait for tomorrow” during the speeches?', options: ['Over', 'Under'] }
        ]
      },
      {
        title: 'Wedding Day Lines',
        questions: [
          { key: 'wd_on_time', prompt: 'Will the ceremony start on time (within 5 min of 4:00 PM)?', options: ['Yes', 'No'] },
          { key: 'wd_judson_tears', prompt: 'Will there be visible tears from Judson?', options: ['Yes', 'No'] },
          { key: 'wd_phone_go_off', prompt: 'Will someone’s phone go off during the ceremony?', options: ['Yes', 'No'] },
          { key: 'wd_kiss_length', prompt: 'Will the kiss last longer than 3 seconds?', options: ['Yes', 'No'] },
          { key: 'wd_ceremony_len', prompt: 'Ceremony length of time Over/Under 19.5 minutes.', options: ['Over', 'Under'] },
          { key: 'wd_cake_cut', prompt: 'Over/Under 7:30 PM for cake cutting.', options: ['Over', 'Under'] },
          { key: 'wd_kayla_outfit', prompt: 'Will Kayla change outfits during the night?', options: ['Yes', 'No'] },
          { key: 'wd_line_dance', prompt: 'Will there be a line dance (Cha Cha Slide, Wobble, etc.)?', options: ['Yes', 'No'] },
          { key: 'wd_brock_cry', prompt: 'Will the Brock cry during the ceremony?', options: ['Yes', 'No'] },
          { key: 'wd_first_dance', prompt: 'First dance song:', options: ['Slow ballad', 'Upbeat song'] },
          { key: 'wd_mr_brightside', prompt: 'Will the DJ play “Mr. Brightside”?', options: ['Yes', 'No'] },
          { key: 'wd_leave_before_10', prompt: 'Will the couple leave before 10:00 PM?', options: ['Yes', 'No'] }
        ]
      }
    ];

    const authView = document.getElementById('authView');
    const picksView = document.getElementById('picksView');
    const statusView = document.getElementById('statusView');
    const headerStatus = document.getElementById('headerStatus');
    const picksUserName = document.getElementById('picksUserName');
    const statusUserName = document.getElementById('statusUserName');
    const scoreboardBody = document.getElementById('scoreboardBody');
    const scoreboardMeta = document.getElementById('scoreboardMeta');
    const resultsEditor = document.getElementById('resultsEditor');
    const myPicks = document.getElementById('myPicks');
    const picksError = document.getElementById('picksError');

    let users = loadUsers();
    let results = loadResults();
    let currentUser = loadSession();

    buildQuestionCards();
    updateHeaderStatus();
    if (currentUser) {
      const found = users.find(u => u.id === currentUser.id);
      if (found) {
        currentUser = found;
        showView(found.picks ? 'status' : 'picks');
      } else {
        clearSession();
        showView('auth');
      }
    } else {
      showView('auth');
    }

    document.getElementById('registerForm').addEventListener('submit', handleRegister);
    document.getElementById('loginForm').addEventListener('submit', handleLogin);
    document.getElementById('logoutFromPicks').addEventListener('click', logout);
    document.getElementById('logoutFromStatus').addEventListener('click', logout);
    document.getElementById('savePicks').addEventListener('click', savePicksForUser);
    document.getElementById('exportPicks').addEventListener('click', exportCurrentPicks);
    document.getElementById('copyPicks').addEventListener('click', copyCurrentPicks);
    document.getElementById('printPicks').addEventListener('click', () => window.print());
    document.getElementById('editPicks').addEventListener('click', () => showView('picks'));
    document.getElementById('toStatus').addEventListener('click', () => showView('status'));

    function loadUsers() {
      try {
        const raw = localStorage.getItem(storageKeys.users);
        return raw ? JSON.parse(raw) : [];
      } catch {
        return [];
      }
    }

    function saveUsers() {
      localStorage.setItem(storageKeys.users, JSON.stringify(users));
    }

    function loadResults() {
      try {
        const raw = localStorage.getItem(storageKeys.results);
        return raw ? JSON.parse(raw) : {};
      } catch {
        return {};
      }
    }

    function saveResults() {
      localStorage.setItem(storageKeys.results, JSON.stringify(results));
    }

    function loadSession() {
      try {
        const raw = localStorage.getItem(storageKeys.session);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        if (!parsed.id) return null;
        return users.find(u => u.id === parsed.id) || null;
      } catch {
        return null;
      }
    }

    function setSession(user) {
      localStorage.setItem(storageKeys.session, JSON.stringify({ id: user.id }));
      currentUser = user;
      updateHeaderStatus();
    }

    function clearSession() {
      localStorage.removeItem(storageKeys.session);
      currentUser = null;
      updateHeaderStatus();
    }

    function updateHeaderStatus() {
      if (currentUser) {
        headerStatus.textContent = `Signed in as ${currentUser.firstName} ${currentUser.lastName}`;
      } else {
        headerStatus.textContent = 'Sign in to start making your picks.';
      }
    }

    function buildQuestionCards() {
      const container = document.getElementById('questionSections');
      container.innerHTML = sections.map(section => {
        const questionsMarkup = section.questions.map(q => {
          const optionsMarkup = q.options.map(opt => `
            <label>
              <input type="radio" name="${q.key}" value="${opt}" /> ${opt}
            </label>
          `).join('');
          return `
            <div class="q" data-key="${q.key}">
              <p>${q.prompt}</p>
              <div class="row">${optionsMarkup}</div>
              <div class="req">Please choose an option.</div>
            </div>
          `;
        }).join('');
        return `
          <section class="card">
            <h2>${section.title}</h2>
            <div class="stack">${questionsMarkup}</div>
          </section>
        `;
      }).join('');
    }

    function showView(view) {
      [authView, picksView, statusView].forEach(v => v.classList.remove('active'));
      if (view === 'auth') {
        authView.classList.add('active');
      } else if (view === 'picks') {
        if (!currentUser) { showView('auth'); return; }
        picksView.classList.add('active');
        picksUserName.textContent = `${currentUser.firstName} ${currentUser.lastName}`;
        restoreSelections();
      } else if (view === 'status') {
        if (!currentUser) { showView('auth'); return; }
        statusView.classList.add('active');
        statusUserName.textContent = `${currentUser.firstName} ${currentUser.lastName}`;
        renderStatus();
      }
    }

    function handleRegister(event) {
      event.preventDefault();
      const first = document.getElementById('registerFirst').value.trim();
      const last = document.getElementById('registerLast').value.trim();
      const password = document.getElementById('registerPassword').value;
      const errorEl = document.getElementById('registerError');
      errorEl.textContent = '';

      if (!first || !last || !password) {
        errorEl.textContent = 'Please fill out every field.';
        return;
      }

      const exists = users.some(u => u.firstName.toLowerCase() === first.toLowerCase() && u.lastName.toLowerCase() === last.toLowerCase());
      if (exists) {
        errorEl.textContent = 'That name is already registered. Try signing in instead.';
        return;
      }

      const newUser = {
        id: (window.crypto && crypto.randomUUID) ? crypto.randomUUID() : `user-${Date.now()}-${Math.random().toString(16).slice(2)}`,
        firstName: first,
        lastName: last,
        password,
        picks: null
      };
      users.push(newUser);
      saveUsers();
      setSession(newUser);
      document.getElementById('registerForm').reset();
      showView('picks');
    }

    function handleLogin(event) {
      event.preventDefault();
      const first = document.getElementById('loginFirst').value.trim();
      const last = document.getElementById('loginLast').value.trim();
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');
      errorEl.textContent = '';

      if (!first || !last || !password) {
        errorEl.textContent = 'Please fill out every field.';
        return;
      }

      const user = users.find(u => u.firstName.toLowerCase() === first.toLowerCase() && u.lastName.toLowerCase() === last.toLowerCase());
      if (!user || user.password !== password) {
        errorEl.textContent = 'Check your name and password, then try again.';
        return;
      }

      setSession(user);
      document.getElementById('loginForm').reset();
      showView(user.picks ? 'status' : 'picks');
    }

    function logout() {
      clearSession();
      showView('auth');
    }

    function restoreSelections() {
      document.querySelectorAll('#questionSections input[type="radio"]').forEach(input => {
        input.checked = false;
      });
      picksError.textContent = '';
      if (!currentUser || !currentUser.picks) return;
      Object.entries(currentUser.picks.answers).forEach(([key, value]) => {
        const radios = document.querySelectorAll(`#questionSections input[name="${key}"]`);
        radios.forEach(radio => {
          if (radio.value === value) radio.checked = true;
        });
      });
    }

    function readSelections() {
      const answers = {};
      let valid = true;
      sections.forEach(section => {
        section.questions.forEach(q => {
          const chosen = document.querySelector(`#questionSections input[name="${q.key}"]:checked`);
          answers[q.key] = chosen ? chosen.value : '';
          const block = document.querySelector(`.q[data-key="${q.key}"] .req`);
          if (!chosen) {
            valid = false;
            block.style.display = 'block';
          } else {
            block.style.display = 'none';
          }
        });
      });
      return { answers, valid };
    }

    function savePicksForUser() {
      if (!currentUser) return;
      const { answers, valid } = readSelections();
      if (!valid) {
        picksError.textContent = 'Please answer every line before saving your picks.';
        return;
      }
      picksError.textContent = '';
      currentUser.picks = { answers, submittedAt: new Date().toISOString() };
      users = users.map(u => (u.id === currentUser.id ? currentUser : u));
      saveUsers();
      alert('Saved! Your picks are locked in for this browser.');
      showView('status');
    }

    function exportCurrentPicks() {
      if (!currentUser || !currentUser.picks) {
        alert('Save your picks first.');
        return;
      }
      const headers = ['firstName', 'lastName', 'submittedAt', ...allKeys()];
      const row = headers.map(key => {
        if (key === 'firstName') return currentUser.firstName;
        if (key === 'lastName') return currentUser.lastName;
        if (key === 'submittedAt') return currentUser.picks.submittedAt;
        return currentUser.picks.answers[key] || '';
      });
      const csv = headers.join(',') + '\n' + row.map(v => `"${(v || '').toString().replaceAll('"','""')}"`).join(',');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `wedding-pool_${currentUser.firstName}-${currentUser.lastName}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function copyCurrentPicks() {
      if (!currentUser || !currentUser.picks) {
        alert('Save your picks first.');
        return;
      }
      const payload = {
        firstName: currentUser.firstName,
        lastName: currentUser.lastName,
        ...currentUser.picks.answers,
        submittedAt: currentUser.picks.submittedAt
      };
      const json = JSON.stringify(payload);
      navigator.clipboard.writeText(json).then(() => {
        alert('Copied your entry JSON to the clipboard!');
      }).catch(() => {
        alert(`Copy failed. Here is your data:\n${json}`);
      });
    }

    function allKeys() {
      return sections.flatMap(section => section.questions.map(q => q.key));
    }

    function renderStatus() {
      renderScoreboard();
      renderResultsEditor();
      renderMyPicks();
    }

    function renderScoreboard() {
      const entries = [...users];
      const resolvedKeys = allKeys().filter(key => results[key]);
      const totalResolved = resolvedKeys.length;
      const submittedCount = entries.filter(entry => entry.picks).length;
      const playersText = entries.length
        ? `${entries.length} player${entries.length === 1 ? '' : 's'}`
        : 'No players yet';
      const submissionsText = submittedCount
        ? `${submittedCount} submission${submittedCount === 1 ? '' : 's'}`
        : 'No submissions yet';
      const resolvedText = totalResolved
        ? `${totalResolved} line${totalResolved === 1 ? '' : 's'} resolved`
        : 'awaiting first result';
      scoreboardMeta.textContent = `${playersText} • ${submissionsText} • ${resolvedText}.`;

      entries.sort((a, b) => {
        const scoreDiff = scoreFor(b) - scoreFor(a);
        if (scoreDiff !== 0) return scoreDiff;
        const aSubmitted = Boolean(a.picks);
        const bSubmitted = Boolean(b.picks);
        if (aSubmitted !== bSubmitted) {
          return aSubmitted ? -1 : 1;
        }
        if (!aSubmitted || !bSubmitted) return 0;
        const diff = new Date(a.picks.submittedAt) - new Date(b.picks.submittedAt);
        return Number.isNaN(diff) ? 0 : diff;
      });

      scoreboardBody.innerHTML = entries.map(entry => {
        const hasPicks = Boolean(entry.picks);
        const score = scoreFor(entry);
        const submittedAt = entry.picks?.submittedAt ? new Date(entry.picks.submittedAt) : null;
        const submittedText = hasPicks && submittedAt && !isNaN(submittedAt)
          ? submittedAt.toLocaleString()
          : 'Not submitted';
        return `
          <tr class="${currentUser && entry.id === currentUser.id ? 'highlight' : ''}">
            <td>${entry.firstName} ${entry.lastName}</td>
            <td>${hasPicks ? score : '—'}</td>
            <td>${totalResolved}</td>
            <td>${submittedText}</td>
          </tr>
        `;
      }).join('') || '<tr><td colspan="4">No entries yet. Once picks are submitted, they will appear here.</td></tr>';
    }

    function scoreFor(user) {
      if (!user.picks) return 0;
      return allKeys().reduce((acc, key) => {
        if (!results[key]) return acc;
        return acc + (user.picks.answers[key] === results[key] ? 1 : 0);
      }, 0);
    }

    function canEditResults(user) {
      if (!user) return false;
      const first = (user.firstName || '').toLowerCase();
      const last = (user.lastName || '').toLowerCase();
      return first === 'jackson' && last === 'derose';
    }

    function renderResultsEditor() {
      const canEdit = canEditResults(currentUser);
      const introNote = canEdit
        ? '<p class="meta results-note">Update each line as the events happen. Changes save instantly for everyone.</p>'
        : '<p class="meta results-note">Only Jackson DeRose can update the actual results. You can still follow along below.</p>';

      const sectionsMarkup = sections.map(section => {
        const block = section.questions.map(q => {
          const options = [''].concat(q.options);
          const optionsMarkup = options.map(opt => {
            const label = opt ? opt : 'Unresolved';
            const selected = results[q.key] === opt ? 'selected' : '';
            return `<option value="${opt}" ${selected}>${label}</option>`;
          }).join('');
          return `
            <label class="stack" style="margin-bottom:8px;">
              <span>${q.prompt}</span>
              <select data-key="${q.key}">${optionsMarkup}</select>
            </label>
          `;
        }).join('');
        return `
          <div class="stack" style="margin-bottom:16px;">
            <h4 style="margin:0;">${section.title}</h4>
            ${block}
          </div>
        `;
      }).join('');

      resultsEditor.innerHTML = `${introNote}${sectionsMarkup}`;

      resultsEditor.querySelectorAll('select').forEach(select => {
        if (!canEdit) {
          select.disabled = true;
          return;
        }
        select.addEventListener('change', event => {
          const key = event.target.dataset.key;
          const value = event.target.value;
          if (value) {
            results[key] = value;
          } else {
            delete results[key];
          }
          saveResults();
          renderStatus();
        });
      });
    }

    function renderMyPicks() {
      if (!currentUser || !currentUser.picks) {
        myPicks.innerHTML = '<p class="meta">You have not saved any picks yet.</p>';
        return;
      }
      const rows = sections.map(section => {
        const items = section.questions.map(q => {
          const pick = currentUser.picks.answers[q.key];
          const actual = results[q.key] || 'Pending';
          const status = !results[q.key]
            ? 'pending'
            : results[q.key] === pick
              ? 'correct'
              : 'incorrect';
          const statusText = status === 'pending' ? 'Pending' : status === 'correct' ? 'Correct' : 'Incorrect';
          return `
            <tr>
              <td style="width:45%;">${q.prompt}</td>
              <td style="width:20%;">${pick || '—'}</td>
              <td style="width:20%;">${actual}</td>
              <td style="width:15%;"><span class="status-chip ${status}">${statusText}</span></td>
            </tr>
          `;
        }).join('');
        return `
          <div style="margin-bottom:16px;">
            <h4 style="margin:0 0 8px 0;">${section.title}</h4>
            <div style="overflow-x:auto;">
              <table>
                <thead>
                  <tr>
                    <th>Line</th>
                    <th>Your pick</th>
                    <th>Actual</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>${items}</tbody>
              </table>
            </div>
          </div>
        `;
      }).join('');
      myPicks.innerHTML = rows;
    }
  </script>
</body>
</html>
